import{j as e,I as _,T as f,D as ne,$ as O,b as D,d as E,e as L,f as M,h as Z,i as v,r as d,k as F,B as H,l as ae,q as B,S,u as ie,A,m as U,n as re,o as P,p as oe,N as j,s as q,t as le,v as ce,M as C,L as de,w as Q,x as ue,y as fe,z as he,C as me,E as K,F as xe,H as R,J as ge,K as pe,O as be}from"./index-BX768Frx.js";import{u as y}from"./useQuery-DHwdh6Ld.js";import{T as je}from"./tag-DIbqHQC5.js";import{I as ve}from"./id-DHkDYjrH.js";import{u as T,a as ye,S as we}from"./use-side-panel-CNojKWDu.js";import{u as G}from"./use-breakpoint-BeTowhVH.js";import{E as Ce}from"./empty-list-CHaQSvfG.js";import{u as Ne}from"./use-api-CjnAIHV2.js";import"./useBaseQuery-DCSHiJ5h.js";function Le(t){const s=t.split(" ");return s.length===0?"":s.length===1?s[0].substring(0,2).toUpperCase():s[0].charAt(0).toUpperCase()+s[1].charAt(0).toUpperCase()}function k({icon:t,text:s,url:n,isLoading:a}){return e.jsx("div",{className:"bg-accent inline-flex size-8 shrink-0 flex-col items-center justify-center overflow-hidden rounded-full align-top",children:a?e.jsx("div",{className:"bg-accent-secondary h-full w-full animate-pulse"}):t?e.jsx(_,{type:t,size:"lg",className:"text-on-brand"}):e.jsx(f,{as:"div",size:"sm",weight:"medium",className:"text-on-brand",children:n?e.jsx("img",{src:n,alt:s,className:"h-full w-full object-cover"}):s?Le(s):e.jsx("img",{alt:"Nestor Doe",src:ne,className:"mt-4 mr-0.5 max-w-12"})})})}function He({open:t,setOpen:s,title:n,children:a}){return e.jsx(O,{isDismissable:!0,isOpen:t,onOpenChange:s,className:"text-primary fixed inset-0 z-50 bg-black/50 data-[entering]:animate-[modal-blur_300ms] data-[exiting]:animate-[modal-blur_300ms_reverse_ease-in]",children:e.jsx(D,{className:"bg-primary fixed inset-y-0 right-0 w-full max-w-2xl overflow-y-scroll p-4 shadow-lg data-[entering]:animate-[modal-slide_300ms] data-[exiting]:animate-[modal-slide_300ms_reverse_ease-in]",children:e.jsxs(E,{children:[e.jsxs("div",{className:"mb-4 flex items-center justify-between gap-4",children:[e.jsx(f,{variant:"heading",size:"md",slot:"title",children:n}),e.jsx(L,{icon:"close",slot:"close",variant:"tertiary"})]}),a]})})})}function ke({text:t,color:s="accent",underline:n="always",children:a}){return e.jsx(M,{label:t,offset:2,maxWidth:400,children:e.jsx(Z,{className:v("cursor-help decoration-dashed decoration-1 underline-offset-2 hover:underline",s==="accent"&&"text-accent hover:text-accent-hover",s==="inherit"&&"hover:opacity-80",n==="always"&&"underline"),children:a})})}const _e="/assets/plakar-illustration-hello-CUlCX5j7.svg",z=d.createContext(null);function Se(){return typeof document>"u"?z:window.__TSR_ROUTER_CONTEXT__?window.__TSR_ROUTER_CONTEXT__:(window.__TSR_ROUTER_CONTEXT__=z,z)}function Ie(t){return d.useContext(Se())}function ze(t){const s=Ie();return d.useCallback(n=>s.navigate({...n,from:n.from??t?.from}),[t?.from,s])}function X({href:t,onClick:s}){const n=ze(),a=!t;return e.jsxs("div",{className:"bg-accent grid grid-cols-[1fr_auto] items-center rounded-sm",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsxs("div",{className:"flex flex-col justify-center gap-0.5 py-2 pl-3",children:[e.jsxs(f,{className:"text-on-brand",weight:"medium",size:"sm",children:[a?"Sign in":e.jsx(F,{href:t,onPress:s,className:"hover:text-on-brand/80 underline",children:"Sign in"})," ","to get access to all features"]}),e.jsx(f,{className:"text-on-brand",size:"xs",children:"Magic link or GitHub"})]}),e.jsx("div",{className:"self-end",children:e.jsx("img",{alt:"plakar.io",src:_e,className:"h-[70px] w-[90px]"})})]}),a&&e.jsx(H,{leftIcon:"right-to-bracket",variant:"accent-tertiary",className:"mr-2 sm:mr-6",onClick:()=>{n({to:"/login"}),s?.()},slot:"close",children:"Sign in"})]})}const Me="data:image/svg+xml,%3csvg%20width='71'%20height='14'%20viewBox='0%200%2071%2014'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0%2013.2324V0.767555H5.38035C8.14965%200.767555%2010.006%202.52043%2010.006%205.17409C10.006%207.85818%208.10096%209.53193%205.25863%209.53193H3.38402V13.2324H0ZM3.38402%206.90262H4.57695C5.76379%206.90262%206.4759%206.2392%206.4759%205.17409C6.4759%204.10289%205.76379%203.4699%204.57695%203.4699H3.38402V6.90262Z'%20fill='white'/%3e%3cpath%20d='M11.2476%2013.2324V0.767555H14.6316V10.5058H19.6712V13.2324H11.2476Z'%20fill='white'/%3e%3cpath%20d='M24.277%2013.2324H20.6252L24.7396%200.767555H29.3652L33.4796%2013.2324H29.8278L29.1096%2010.8466H24.9952L24.277%2013.2324ZM25.7621%208.31466H28.3427L27.1011%204.20027H27.0037L25.7621%208.31466Z'%20fill='white'/%3e%3cpath%20d='M34.6801%2013.2324V0.767555H38.0642V5.80707H38.2346L41.9838%200.767555H45.9278L41.716%206.31833L46.0251%2013.2324H41.9838L39.1841%208.55811L38.0642%2010.0188V13.2324H34.6801Z'%20fill='white'/%3e%3cpath%20d='M50.17%2013.2324H46.5181L50.6325%200.767555H55.2582L59.3726%2013.2324H55.7207L55.0025%2010.8466H50.8882L50.17%2013.2324ZM51.655%208.31466H54.2357L52.994%204.20027H52.8967L51.655%208.31466Z'%20fill='white'/%3e%3cpath%20d='M60.5731%2013.2324V0.767555H65.9535C68.7227%200.767555%2070.5791%202.35001%2070.5791%205.00367C70.5791%206.7322%2069.7879%207.94339%2068.461%208.58246L70.993%2013.2324H67.3168L65.1257%209.11806H63.9571V13.2324H60.5731ZM63.9571%206.48875H65.1501C66.3369%206.48875%2067.049%206.06879%2067.049%205.00367C67.049%203.93247%2066.3369%203.4699%2065.1501%203.4699H63.9571V6.48875Z'%20fill='white'/%3e%3c/svg%3e",Pe="data:image/svg+xml,%3csvg%20width='24'%20height='24'%20viewBox='0%200%2024%2024'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3crect%20width='24'%20height='24'%20rx='12'%20fill='%230F172A'/%3e%3cpath%20d='M17.4287%209.9511C17.1909%209.19212%2016.801%208.50159%2016.2956%207.91434C16.6544%207.64774%2016.8869%207.21841%2016.8869%206.73504C16.8869%205.92562%2016.2354%205.26992%2015.4325%205.26992C14.7744%205.26992%2014.2189%205.71005%2014.0395%206.31352C13.3975%206.06252%2012.7001%205.92502%2011.9705%205.92502C11.3131%205.92502%2010.6812%206.0373%2010.0929%206.24266C9.89205%205.67583%209.35441%205.26992%208.72258%205.26992C7.91908%205.26992%207.26818%205.92622%207.26818%206.73504C7.26818%207.16077%207.44819%207.54386%207.73609%207.81167C7.18652%208.41993%206.76451%209.14709%206.51237%209.9505V9.95171C4.35701%2010.2015%202.68326%2012.0455%202.68326%2014.2834C2.68326%2016.6919%204.62166%2018.6446%207.01247%2018.6446C8.08181%2018.6446%209.05995%2018.2531%209.81516%2017.6058L13.3385%2017.613L14.1235%2017.6082C14.8787%2018.2543%2015.8557%2018.6446%2016.9238%2018.6446C19.3146%2018.6446%2021.253%2016.6919%2021.253%2014.2834C21.253%2012.0467%2019.5817%2010.2033%2017.4287%209.9511ZM11.9693%206.85933C12.3723%206.85933%2012.7633%206.91218%2013.137%207.01666L12.4194%209.84783C12.3979%209.93309%2012.3288%209.99134%2012.2489%209.99013C12.0933%209.98773%2011.8388%209.98833%2011.6832%209.99074C11.6034%209.99194%2011.5342%209.93369%2011.5122%209.84843L10.7993%207.01846C11.1748%206.91278%2011.5658%206.85933%2011.9687%206.85933H11.9693ZM12.7281%2012.0053L12.2596%2012.4232C12.0933%2012.5715%2011.8424%2012.5715%2011.6761%2012.4232L11.2076%2012.0053C10.9042%2011.7345%2011.0943%2011.2301%2011.4996%2011.2301H12.4367C12.842%2011.2301%2013.0315%2011.7351%2012.7287%2012.0053H12.7281ZM10.0184%209.70672C10.3486%209.70672%2010.6163%2010.0718%2010.6163%2010.5227C10.6163%2010.9737%2010.3486%2011.3388%2010.0184%2011.3388C9.6882%2011.3388%209.42057%2010.9737%209.42057%2010.5227C9.42057%2010.0718%209.6882%209.70672%2010.0184%209.70672ZM14.2225%2015.0076C14.4239%2015.2135%2014.4221%2015.545%2014.2177%2015.7479C14.1164%2015.8488%2013.9846%2015.8987%2013.8523%2015.8987C13.72%2015.8987%2013.5841%2015.8464%2013.4821%2015.7425C13.2074%2015.4621%2013.019%2015.0712%2012.9362%2014.6281C12.5922%2014.7013%2012.2411%2014.7386%2011.8901%2014.7386C11.5896%2014.7386%2011.2892%2014.7116%2010.9936%2014.6575C10.9083%2015.088%2010.7218%2015.4681%2010.4535%2015.7425C10.3516%2015.8464%2010.2175%2015.8987%2010.0834%2015.8987C9.94928%2015.8987%209.81934%2015.8482%209.718%2015.7479C9.51355%2015.545%209.51117%2015.2129%209.71324%2015.0076C9.8551%2014.8629%2010.0065%2014.5524%2010.0065%2014.1153C10.0065%2013.7454%209.88669%2013.3905%209.70191%2013.2122C9.49448%2013.0123%209.48792%2012.6808%209.68641%2012.4718C9.8849%2012.2629%2010.2145%2012.2563%2010.4214%2012.4562C10.7063%2012.7312%2010.9072%2013.1359%2010.9954%2013.5905C11.6147%2013.7334%2012.2674%2013.7256%2012.8831%2013.5665L12.9469%2013.5503C13.0393%2013.1119%2013.236%2012.7234%2013.5125%2012.4562C13.72%2012.2563%2014.049%2012.2629%2014.2475%2012.4718C14.446%2012.6808%2014.4394%2013.0123%2014.232%2013.2122C14.0466%2013.3911%2013.9274%2013.7454%2013.9274%2014.1153C13.9274%2014.5524%2014.0788%2014.8629%2014.2213%2015.0076H14.2225ZM13.9179%2011.3382C13.5876%2011.3382%2013.32%2010.9731%2013.32%2010.5221C13.32%2010.0712%2013.5876%209.70612%2013.9179%209.70612C14.2481%209.70612%2014.5157%2010.0712%2014.5157%2010.5221C14.5157%2010.9731%2014.2481%2011.3382%2013.9179%2011.3382Z'%20fill='white'/%3e%3c/svg%3e",Te="data:image/svg+xml,%3csvg%20width='72'%20height='14'%20viewBox='0%200%2072%2014'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0.818226%2013.2324V0.767502H6.19858C8.96788%200.767502%2010.8242%202.52038%2010.8242%205.17404C10.8242%207.85813%208.91919%209.53188%206.07685%209.53188H4.20225V13.2324H0.818226ZM4.20225%206.90257H5.39518C6.58202%206.90257%207.29413%206.23915%207.29413%205.17404C7.29413%204.10283%206.58202%203.46985%205.39518%203.46985H4.20225V6.90257Z'%20fill='%230F172A'/%3e%3cpath%20d='M12.0658%2013.2324V0.767502H15.4499V10.5057H20.4894V13.2324H12.0658Z'%20fill='%230F172A'/%3e%3cpath%20d='M25.0952%2013.2324H21.4434L25.5578%200.767502H30.1835L34.2978%2013.2324H30.646L29.9278%2010.8465H25.8134L25.0952%2013.2324ZM26.5803%208.3146H29.1609L27.9193%204.20022H27.8219L26.5803%208.3146Z'%20fill='%230F172A'/%3e%3cpath%20d='M35.4984%2013.2324V0.767502H38.8824V5.80702H39.0528L42.802%200.767502H46.746L42.5342%206.31827L46.8434%2013.2324H42.802L40.0023%208.55806L38.8824%2010.0188V13.2324H35.4984Z'%20fill='%230F172A'/%3e%3cpath%20d='M50.9882%2013.2324H47.3364L51.4508%200.767502H56.0764L60.1908%2013.2324H56.539L55.8208%2010.8465H51.7064L50.9882%2013.2324ZM52.4733%208.3146H55.0539L53.8123%204.20022H53.7149L52.4733%208.3146Z'%20fill='%230F172A'/%3e%3cpath%20d='M61.3913%2013.2324V0.767502H66.7717C69.541%200.767502%2071.3973%202.34996%2071.3973%205.00362C71.3973%206.73215%2070.6061%207.94334%2069.2793%208.58241L71.8112%2013.2324H68.135L65.9439%209.11801H64.7753V13.2324H61.3913ZM64.7753%206.48869H65.9683C67.1551%206.48869%2067.8672%206.06873%2067.8672%205.00362C67.8672%203.93242%2067.1551%203.46985%2065.9683%203.46985H64.7753V6.48869Z'%20fill='%230F172A'/%3e%3c/svg%3e";function W({variant:t="full",isDemo:s}){return e.jsxs("div",{className:"relative inline-flex items-center gap-1 align-top",children:[e.jsx("img",{alt:"plakar.io",src:Pe,className:"w-6 shrink-0"}),t==="full"&&e.jsxs(e.Fragment,{children:[e.jsx("img",{alt:"plakar.io",src:Te,className:"dark:hidden"}),e.jsx("img",{alt:"plakar.io",src:Me,className:"hidden dark:block"})]}),s&&e.jsx(je,{size:"sm",radius:"sqrt",variant:"brand",children:"Demo"})]})}const Y=()=>{const t=d.useContext(ae);if(!t)throw new Error("useTheme must be used within a ThemeProvider");return t},J=[{id:"dashboard",title:"Dashboard",link:{to:"/"},icon:"house"},{id:"snapshots",title:"Snapshots",link:{to:"/snapshots"},icon:"box-archive"},{id:"alerting",title:"Alerting",link:{to:"/alerting"},icon:"list-check"},{id:"analytics",title:"Analytics",link:{to:"/analytics"},icon:"chart-pie"},{id:"integrations",title:"Integrations",link:{to:"/integrations"},icon:"plug"}],V=[...J,{id:"login",title:"Login",link:{to:"/login"}},{id:"settings",title:"Settings",link:{to:"/settings"}}];function Ae(){return e.jsxs(f,{as:"div",size:"sm",className:"bg-accent-tertiary text-accent grid grid-cols-[auto_1fr] gap-x-2 rounded-md px-2 py-1",children:[e.jsx("div",{className:"row-start-1 flex items-center",children:e.jsx(_,{type:"info-circle",size:"sm"})}),e.jsx("p",{className:"row-start-1",children:e.jsx("strong",{children:"Demo Mode"})}),e.jsx(f,{size:"xs",className:"text-secondary col-start-2 row-start-2",children:"You're signed in as a demo user."})]})}const Re=t=>B({queryKey:["api","discord","server_stats",t],queryFn:async()=>{const a=(await(await fetch(`https://discord.com/api/invites/${t}`)).json())?.profile?.member_count;if(a===void 0)throw new Error("Invalid response from Discord API");return a},refetchOnMount:!1,refetchOnWindowFocus:!1,refetchOnReconnect:!1});function Ve({invite:t,variant:s="default"}){const{data:n,isPending:a,isSuccess:i}=y(Re(t));return e.jsxs("a",{target:"_blank",href:`https://discord.gg/${t}`,className:v("flex min-w-[60px] gap-1 rounded-sm border px-2 py-1",s==="default"?"border-primary bg-secondary text-secondary hover:bg-secondary-hover":"border-text-on-brand/50 text-on-brand"),children:[e.jsx(_,{type:"discord",size:"md",className:"shrink-0"}),a&&e.jsx(S,{variant:"text",size:"xs",width:"100%"}),i&&e.jsx(f,{variant:"body",size:"xs",monospace:!0,children:n})]})}const $e=t=>B({queryKey:["api","github","repo_stars",t],queryFn:async()=>{const n=await(await fetch(`https://api.github.com/repos/${t}`)).json();if(n.stargazers_count===void 0)throw new Error("Invalid response from GitHub API");return n.stargazers_count},refetchOnMount:!1,refetchOnWindowFocus:!1,refetchOnReconnect:!1});function Oe({repo:t,variant:s="default"}){const{data:n,isPending:a,isSuccess:i}=y($e(t));return e.jsxs("a",{target:"_blank",href:`https://github.com/${t}`,className:v("flex min-w-[60px] gap-1 rounded-sm border px-2 py-1",s==="default"?"border-primary bg-secondary text-secondary hover:bg-secondary-hover":"border-text-on-brand/50 text-on-brand"),children:[e.jsx(_,{type:"github",size:"md",className:"shrink-0"}),a&&e.jsx(S,{variant:"text",size:"xs",width:"100%"}),i&&e.jsx(f,{variant:"body",size:"xs",monospace:!0,children:n})]})}const N=()=>e.jsx(S,{variant:"text",size:"xs"});function De({repositoryInfo:t,isPending:s}){const n=t?.configuration,a=t?.location;return s?[{label:"ID",value:N()},{label:"Location",value:N()},{label:"Chunking",value:N()},{label:"Compression",value:N()},{label:"Encryption",value:N()}]:[{label:"ID",value:e.jsx(ve,{value:n?.repository_id?.Value??"-",size:"xs",className:"h-4"})},{label:"Location",value:a?e.jsx(M,{label:a,children:e.jsx("span",{role:"button",children:a})}):"-"},{label:"Chunking",value:n?.chunking?.algorithm??"Chunking disabled",tooltip:"A chunking algorithm splits data into smaller pieces, or “chunks,” based on specific rules (e.g., fixed size or content-defined). This enables efficient deduplication by identifying and eliminating redundant data. Plakar currently uses FastCDC, a fast and content-aware chunking algorithm."},{label:"Compression",value:n?.compression?.algorithm??"Not compressed",tooltip:"A compression algorithm reduces the size of data by encoding patterns and redundancies, helping save storage space and speed up transfers. Different algorithms offer trade-offs between speed, compression ratio, and resource usage. Plakar currently uses LZ4, a high-speed compression algorithm optimized for fast storage and retrieval."},{label:"Encryption",value:n?.encryption?.data_algorithm??"Not encrypted",tooltip:"An encryption algorithm protects data by transforming it into an unreadable format, ensuring confidentiality and integrity. In encrypted repositories, the only way to access the data is with the correct passphrase — without it, the data remains completely inaccessible."}]}function Ee({label:t,value:s,tooltip:n}){return e.jsx(U.Item,{title:n?e.jsx(ke,{text:n,color:"inherit",children:t}):t,description:s})}function Ze({forceClose:t}){const{isPending:s,isError:n,data:a}=y(re()),[i,o]=ie("kloset-desription-open",!0),l=De({repositoryInfo:a?.item,isPending:s});return n?null:e.jsx(A,{defaultExpandedKeys:i?["kloset"]:[],expandedKeys:t||!i?[]:["kloset"],className:"border-primary overflow-hidden border-t px-2 pt-4",children:e.jsx(A.Item,{id:"kloset",title:"Kloset store",icon:"database",onExpandedChange:()=>o(!i),children:e.jsx(U,{direction:"row",size:"xs",singleColumn:!0,children:l.map(r=>e.jsx(Ee,{label:r.label,value:r.value,tooltip:r.tooltip},r.label))})})})}function Fe({repository:t,onPress:s}){const n=T(P({repository:t,status:"unread"})),a=n.data?.pages[0].__type==="ok"?n.data.pages[0].notifications.total:void 0;return e.jsxs("span",{className:v(a!==void 0&&a>0&&"relative inline-block pr-2"),children:[e.jsx(L,{"aria-label":"Open notifications",variant:"tertiary",icon:(a!==void 0&&a>0,"bell"),onPress:s,size:"sm",tooltip:"Notifications"}),a!==void 0&&a>0&&e.jsx("span",{className:"pointer-events-none absolute -top-2 right-0 flex min-w-4 items-center justify-center rounded-full bg-red-500 px-0.75 text-xs font-medium text-white",children:a>99?"99+":a})]})}function $(t){const s=/([^-]+(?:-[^.\s]+)?(?:\.\d+)?)(?:\.([a-f0-9]{7})[a-f0-9]*)?$/;return{Value:t,Pretty:t.replace(s,(n,a,i)=>i?`${a}.${i}`:a),Channel:t.replace(s,"$1")}}function Be({value:t,channel:s=!1}){const n=s?$(t).Channel:$(t).Pretty,a=e.jsx(f,{as:i=>e.jsx("button",{...i}),variant:"body",size:"xs",className:"text-tertiary",children:n});return n!==t?e.jsx(M,{label:t,children:a}):a}function ee(){const t=oe();return V.find(a=>t({to:a.link.to,fuzzy:!0,pending:!0}))??V.find(a=>t({to:a.link.to,fuzzy:!0}))}function te({repository:t,version:s,isExpanded:n,isFloating:a,canExpand:i,isDemo:o,handleToggle:l,onCloseMenu:r,setNotificationsOpen:p}){const{mode:x,toggleMode:g}=Y(),u=ee(),c=y(q()),w=n?"full":"icon",I=n&&!a?"chevrons-left":"chevrons-right",h=!!c.data,b=c.isPending;return e.jsxs("div",{className:"flex min-h-full flex-col justify-between gap-4",children:[e.jsxs("div",{className:"flex flex-col gap-8",children:[e.jsxs("div",{className:"mx-1 flex items-baseline justify-between",children:[e.jsx(F,{href:{to:"/"},children:e.jsx(W,{variant:w,isDemo:o&&n})}),n&&e.jsx(Be,{value:s,channel:o})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("span",{className:"flex min-w-0 items-center justify-between gap-2",children:[e.jsxs("span",{className:"flex min-w-0 items-center gap-2",children:[h?e.jsx(k,{text:c.data?.name||"",url:c.data?.avatar_url,isLoading:b}):e.jsx(k,{icon:"incognito",isLoading:b}),n&&(b?e.jsx(S,{variant:"text",size:"sm",width:135}):e.jsx(f,{className:"text-tertiary truncate",size:"sm",weight:"medium",children:h?c.data?.name||"You are logged in":"Guest"}))]}),n&&e.jsxs("span",{className:"flex items-center gap-2",children:[!h&&!b&&e.jsx(L,{icon:"right-to-bracket",size:"sm",variant:"tertiary",tooltip:"Sign in",href:{to:"/login"}}),e.jsx(Fe,{repository:t,onPress:()=>p(m=>!m)})]})]}),e.jsx(j,{"aria-label":"main navigation",children:J.map(m=>e.jsx(j.Item,{icon:m.icon,label:m.title,isSelected:u?.id===m.id,href:{to:m.link.to},onAction:r},m.id))})]})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[n&&!b&&e.jsxs(e.Fragment,{children:[o&&h&&e.jsx(Ae,{}),!o&&!h&&e.jsx(X,{href:{to:"/login"},onClick:r})]}),e.jsx(Ze,{forceClose:!n}),e.jsxs("div",{className:"border-primary flex flex-col gap-8 border-t pt-4",children:[e.jsxs(j,{"aria-label":"settings navigation",children:[e.jsx(j.Item,{"aria-label":"Toggle theme",icon:x.icon,label:x.label,onAction:g,className:"cursor-pointer"}),e.jsx(j.Item,{icon:"gear",label:"Settings",href:{to:"/settings"},onAction:r,isSelected:u?.id==="settings",isDisabled:!h}),h?e.jsx(j.Item,{icon:"right-to-bracket",label:"Sign out",href:{to:"/logout"},onAction:r,isDisabled:o}):e.jsx(j.Item,{icon:"right-to-bracket",label:"Sign in",href:{to:"/login"},onAction:r,isSelected:u?.id==="login"})]}),e.jsxs("div",{className:"flex h-[26px] justify-between gap-2",children:[n&&e.jsxs("div",{className:"flex w-full items-center justify-center gap-2 lg:justify-start",children:[e.jsx(Ve,{invite:"uuegtnF2Q5"}),e.jsx(Oe,{repo:"PlakarKorp/plakar"})]}),l&&e.jsx(L,{"aria-label":"Toggle sidebar",icon:I,size:"sm",variant:"tertiary",onPress:l,tooltip:"Toggle sidebar",isDisabled:!i,className:v(!n&&"w-full text-center")})]})]})]})]})}function Ue({isDemo:t=!1,isApiInfoPending:s=!1}){const n=y(q()),{mode:a,toggleMode:i}=Y(),o=n.data!==null,l=n.isPending||s;return e.jsxs(le,{children:[e.jsx(Z,{"aria-label":"Profile",className:"cursor-pointer",children:o?e.jsx(k,{text:n.data?.name||"",url:n.data?.avatar_url,isLoading:l}):e.jsx(k,{icon:"incognito"})}),!l&&e.jsx(ce,{placement:"bottom end",offset:4,children:e.jsxs(C,{children:[e.jsx(C.Item,{leftIcon:a.icon,label:a.label,onAction:i,className:"cursor-pointer"}),o?e.jsxs(e.Fragment,{children:[e.jsx(C.Item,{leftIcon:"gear",label:"Settings",href:{to:"/settings"}}),e.jsx(C.Item,{leftIcon:"right-to-bracket",label:"Sign out",href:{to:"/logout"},isDisabled:t})]}):e.jsx(C.Item,{leftIcon:"right-to-bracket",label:"Sign in",href:{to:"/login"}})]})})]})}function qe({repository:t,version:s,isDemo:n,setNotificationsOpen:a}){const[i,o]=d.useState(!1),l=ee(),{isPending:r}=y(Q());return e.jsxs(e.Fragment,{children:[e.jsxs("header",{className:"border-primary bg-primary flex items-center justify-between border-b p-2 pl-4 lg:hidden",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{to:"/",children:e.jsx(W,{variant:"icon"})}),e.jsx(H,{variant:"tertiary",leftIcon:"bars",size:"sm",onPress:()=>o(!0),children:l?.title})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx(Ue,{isApiInfoPending:r,isDemo:n})})]}),e.jsx(O,{isOpen:i,onOpenChange:o,className:"fixed inset-0 bg-black/50 data-[entering]:animate-[modal-fade_150ms] data-[exiting]:animate-[modal-fade_reverse_150ms] xl:hidden",isDismissable:!0,children:e.jsx(D,{className:"bg-primary fixed left-0 z-1 h-full w-64 overflow-auto shadow-xl data-[entering]:animate-[modal-slide-right_200ms_ease-out] data-[exiting]:animate-[modal-slide-right_150ms_reverse_ease-in]",children:e.jsx(E,{"aria-label":"Navigation",className:"h-full overflow-y-auto px-2 py-4",children:e.jsx(te,{repository:t,version:s,isExpanded:!0,isFloating:!1,canExpand:!1,isDemo:n,onCloseMenu:()=>o(!1),setNotificationsOpen:a})})})})]})}function Qe(){const{position:t}=ye(),{preview:s}=ue({strict:!1}),{is3xlDown:n}=G();return!!s&&t==="horizontal"&&n}function Ke({repository:t,version:s,setNotificationsOpen:n}){const{isLgUp:a,isXlUp:i}=G(),{data:{demo_mode:o}={}}=y(Q()),l=Qe(),[r,p]=d.useState(!0),[x,g]=d.useState(!1);if(!a)return e.jsx(qe,{repository:t,version:s,setNotificationsOpen:n,isDemo:o});const u=!l&&i,c=r&&u||x,w=x&&!(r&&u)||!a,I=!l,h=()=>{g(!0)},b=()=>{g(!1)},m=()=>{p(se=>!se),g(!1)};return e.jsxs(e.Fragment,{children:[e.jsx("aside",{className:v("border-primary bg-primary absolute z-1 h-full overflow-y-auto border-r px-2 py-4",c?"w-64":"w-12",w&&"shadow-xl"),onMouseEnter:h,onMouseLeave:b,children:e.jsx(te,{repository:t,version:s,isExpanded:c,isFloating:w,canExpand:u,isDemo:o,handleToggle:m,setNotificationsOpen:n})}),e.jsx("div",{className:v("h-full",c&&!w?"w-64":"w-12",I&&"transition-[width] duration-150 ease-out")})]})}const Ge=["horizontal","vertical"],Xe=he(Ge);function We({children:t}){const[s,n]=d.useState(()=>{const i=fe("sidebar-position"),o=Xe.safeParse(i);return o.success?o.data:"horizontal"}),a=d.useCallback(i=>{n(i),me("sidebar-position",i)},[]);return e.jsx(we.Provider,{value:{position:s,moveSidebar:a},children:t})}const Ye={unknown:"default",info:"default",warning:"warning",error:"error",critical:"error"},Je={unknown:void 0,info:void 0,warning:"Warning",error:"Error",critical:"Critical Error"};function et({repository:t}){const s=T(P({repository:t})),n=K();if(s.isPending)return e.jsx(xe,{});if(s.isError)return e.jsx(Ce,{illustrationType:"sad",title:"Something went wrong while fetching notifications.",description:s.error.message});const a=s.data.pages[0],i=s.data.pages.flatMap(r=>r.notifications?.items).filter(r=>r!==void 0);if(a.__type==="unauthenticated")return e.jsx(X,{});if(i.length===0)return e.jsx("div",{className:"text-sm",children:"You have no unread notifications."});const o=i.some(r=>r.status==="unread"),l=()=>{n.mutate({notificationIds:i.filter(r=>r.status==="unread").map(r=>r.id),status:"read"})};return e.jsxs("div",{className:"flex flex-col gap-3",children:[o&&e.jsx("div",{className:"self-end",children:e.jsx(H,{leftIcon:"check",variant:"secondary",size:"sm",onPress:l,children:"Mark all as read"})}),e.jsx(R,{ariaLabel:"Notifications",children:i.map(r=>e.jsx(R.Item,{severity:Ye[r.level],title:Je[r.level],description:r.message,date:r.created_at.relativeToNow(),unread:r.status==="unread"},r.id))}),s.hasNextPage&&e.jsx(H,{size:"sm",variant:"secondary",onPress:()=>s.fetchNextPage(),isDisabled:s.isFetchingNextPage,children:"Load more"})]})}function tt({repository:t,open:s,setOpen:n}){return e.jsx(He,{open:s,setOpen:n,title:"Notifications",children:e.jsx(et,{repository:t})})}function st(t){const s=d.useRef(!1),{data:n,isPending:a}=T(P({repository:t,status:"unread"})),{mutate:i}=K(),l=n?.pages.map(c=>c.notifications?.items).flat().filter(c=>c?.flags.isBanner).reverse()?.[0],r=l?.level??"unknown",p=l?.id,x=l?.message,g=l?.flags.isBanner,u={unknown:"default",info:"default",warning:"warning",error:"error",critical:"error"}[r];d.useEffect(()=>{s.current||a||!p||!g||(ge({content:{variant:u,title:r,buttonProps:{children:"Mark as read",variant:"secondary",slot:"close",onPress:()=>{i({notificationIds:[p],status:"read"})}},children:x,closable:!1},sticky:!0}),s.current=!0)},[a,u,p,r,x,g,i])}function nt({repository:t,version:s,children:n}){const[a,i]=d.useState(!1);return Ne(),st(t),e.jsxs(We,{children:[e.jsxs("div",{className:"flex h-full min-h-0 flex-col lg:flex-row",children:[e.jsx(Ke,{version:s,repository:t,setNotificationsOpen:i}),e.jsx("main",{className:"relative h-full min-h-0 flex-1",children:e.jsx("div",{className:"h-full overflow-auto",children:n})})]}),e.jsx(tt,{open:a,setOpen:i,repository:t})]})}function ht(){const t=pe.useLoaderData();return e.jsx(nt,{repository:t.repository_id,version:t.version,children:e.jsx(be,{})})}export{ht as component};
